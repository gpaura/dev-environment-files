# ~/.tmux.conf
# tmux configuration for finance/development workflow

# ============================================================================
# GENERAL SETTINGS
# ============================================================================

# Change prefix from Ctrl+b to Ctrl+a (easier to reach)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable mouse support
set -g mouse on

# Optimize for WezTerm and Ghostty (optional)
# set -g default-terminal "wezterm"
# set -ga terminal-overrides ",wezterm:Tc,xterm-ghostty:Tc"
# set -ga terminal-features ",wezterm:RGB,xterm-ghostty:RGB"

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Enable activity alerts
setw -g monitor-activity on
set -g visual-activity on

# Faster command sequences
set -s escape-time 0

# ============================================================================
# KEY BINDINGS
# ============================================================================

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Reload config file
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded!"

# Switch panes using Alt+arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Quick window switching
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# ============================================================================
# VIM-TMUX-NAVIGATOR INTEGRATION (FIXED)
# ============================================================================

# Smart pane switching: only switch panes in tmux when NOT inside Vim
# If inside Vim, let vim-tmux-navigator handle it â€” don't send keys again

is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE 'n?vim'"

bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# Remove copy-mode bindings for C-h/j/k/l to prevent conflicts
unbind -T copy-mode-vi C-h
unbind -T copy-mode-vi C-j
unbind -T copy-mode-vi C-k
unbind -T copy-mode-vi C-l

# ============================================================================
# COPY MODE (VI-STYLE)
# ============================================================================

setw -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# Enter copy mode with Ctrl+a [
bind [ copy-mode
bind ] paste-buffer

# ============================================================================
# APPEARANCE & STATUS BAR
# ============================================================================

set-option -g status-position bottom
set -g status-bg colour235
set -g status-fg colour255

set -g status-left-length 20
set -g status-left '#[fg=colour46,bold][#S] '

set -g status-right-length 60
set -g status-right '#[fg=colour255]%Y-%m-%d #[fg=colour46,bold]%H:%M'

setw -g window-status-format ' #I:#W '
setw -g window-status-current-format '#[fg=colour235,bg=colour46,bold] #I:#W '

set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour46

set -g message-style bg=colour46,fg=colour235,bold

# ============================================================================
# SPECIALIZED BINDINGS FOR DEVELOPMENT
# ============================================================================

bind M-1 select-layout even-horizontal
bind M-2 select-layout even-vertical
bind M-3 select-layout main-horizontal
bind M-4 select-layout main-vertical
bind M-5 select-layout tiled

# Resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Kill session
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# ============================================================================
# FINANCE/TRADING SPECIFIC FEATURES
# ============================================================================

bind C-t new-session -d -s "trading" \; switch-client -t "trading"
bind C-d new-session -d -s "development" \; switch-client -t "development"
bind C-m new-session -d -s "monitoring" \; switch-client -t "monitoring"

# ============================================================================
# PLUGINS (OPTIONAL - REQUIRES TPM)
# ============================================================================

# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# run '~/.tmux/plugins/tpm/tpm'