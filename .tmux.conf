# ~/.tmux.conf - Clean Version for Finance/Dev Workflow

# ============================================================================
# GENERAL SETTINGS
# ============================================================================

unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 50000
setw -g monitor-activity on
set -g visual-activity on
set -s escape-time 10
set -g repeat-time 300
setw -g aggressive-resize off

set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -g set-clipboard on
set -g focus-events on

# ============================================================================
# KEY BINDINGS
# ============================================================================

bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded!"

# ============================================================================
# VIM-TMUX-NAVIGATOR INTEGRATION
# ============================================================================

is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"

unbind C-h
unbind C-j
unbind C-k
unbind C-l

bind-key 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# ============================================================================
# COPY MODE (VI-STYLE)
# ============================================================================

setw -g mode-keys vi

unbind -T copy-mode-vi v
unbind -T copy-mode-vi y
unbind -T copy-mode-vi r

bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi 'r' send-keys -X rectangle-toggle

bind [ copy-mode
bind ] paste-buffer

# ============================================================================
# ENHANCED STATUS BAR WITH GREEN THEME
# ============================================================================

# Status bar refresh every second for live clock
set -g status-interval 1

# Status bar positioning
set-option -g status-position bottom

# Status bar colors
set -g status-bg colour235
set -g status-fg colour255

# Left status - Session info with icon (GREEN)
set -g status-left-length 20
set -g status-left '#[fg=colour46,bold]󰣇 [#S] '

# Right status - Date in yellow, time in green with icons
# set -g status-right-length 80
# set -g status-right '#[fg=colour226] 󰸗 %a %b %d #[fg=colour46,bold] 󰥔 %I:%M:%S %p'

# Right status - Empty (no date/time)
set -g status-right-length 0
set -g status-right ''

# Window status format (keeping your original)
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format '#[fg=colour235,bg=colour46,bold] #I:#W '

# Window status separator
setw -g window-status-separator ''

# Activity and bell colors (GREEN theme)
setw -g window-status-activity-style fg=colour46,bg=colour235,bold
setw -g window-status-bell-style fg=colour235,bg=colour46,bold

# Pane borders with GREEN color
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour46,bold

# Message and command line colors (GREEN theme)
set -g message-style bg=colour46,fg=colour235,bold
set -g message-command-style bg=colour235,fg=colour46,bold

# Copy mode colors (GREEN theme)
setw -g mode-style bg=colour46,fg=colour235,bold

# ============================================================================
# LAYOUT AND RESIZE
# ============================================================================

bind M-1 select-layout even-horizontal
bind M-2 select-layout even-vertical
bind M-3 select-layout main-horizontal
bind M-4 select-layout main-vertical
bind M-5 select-layout tiled

bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

bind -r Left resize-pane -L 5
bind -r Down resize-pane -D 5
bind -r Up resize-pane -U 5
bind -r Right resize-pane -R 5

# ============================================================================
# SESSION MANAGEMENT
# ============================================================================

bind X confirm-before -p "Kill session #S? (y/n)" kill-session

bind C-t new-session -d -s "trading" \; switch-client -t "trading"
bind C-d new-session -d -s "development" \; switch-client -t "development"
bind C-m new-session -d -s "monitoring" \; switch-client -t "monitoring"